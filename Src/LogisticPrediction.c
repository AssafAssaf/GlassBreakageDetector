/**
  ******************************************************************************
  * @file    GlassBreaking/Inc/LogisticPrediction.c 
  * @author  Assaf & Assaf
  * @version V1.0.0
  * @date    30-January-2017
  * @brief   Prediction related functions
  ******************************************************************************
**/

#include "LogisticPrediction.h"
#include "HardwareConfig.h"

extern UART_HandleTypeDef 					uartHandle;

const float theta[] = {
-0.341886923696085,
-0.107948093761955,
2.98170840728150,
2.07729345889646,
2.67715042241488,
2.29079363080113,
3.14746907609965,
0.479245833267054,
1.42980594589851,
-0.0937714200090223,
-0.256434675761431,
-0.147774122535285,
-0.847278321734413,
0.111746619115811,
0.0507152490952876,
0.0470442281260561,
0.0944073064668835,
0,
0,
0,
1.50435988793448,
-2.27334357990019,
-2.68765040094448,
1.24014550850551,
-0.206829876086867,
2.10106942618045,
-1.27974781902864,
-0.555360740306421,
-2.36007091564674,
-1.63852590486909,
-2.66391596171674,
-1.88073618777863,
-0.758928639110544,
-0.275536656801012,
-0.0839532372292145,
0.0837331924623768,
-0.0538035131106672,
0.00620293574292138,
0.0151362227381362,
-0.612217575454616,
-0.280755093935388,
-0.720624018705935,
1.84779389281733,
0.306132650421474,
-1.23074421318789,
-1.05641781098800,
-1.12145248455026,
-1.13517981779652,
-1.70207185099293,
-1.80341601321598,
-1.13493872114576,
-0.745803638196955,
-0.0538031452653241,
-0.105613619875986,
-0.0283984489483097,
-0.0237863815311649,
-0.0778273877002935,
-0.0514035580516812,
};

char str2[100];

bool Predict(q15_t features[][NUM_OF_FEATURES])
{
	float 	float_features[NUM_OF_FILTERS][NUM_OF_FEATURES];
	float 	result = 0;
	int8_t 	i,j;
	
	for(i=0 ; i<NUM_OF_FILTERS ; i++)
	{
		arm_q15_to_float(features[i], float_features[i], NUM_OF_FEATURES-1);
	}
	
	// remember that the first element of X is always 1
	result = theta[0] * 1;
	
	for(i=0 ; i<NUM_OF_FILTERS ; i++){
		for (j=0 ; j<NUM_OF_FEATURES-1 ; j++){
			result += float_features[i][j] * theta[1 + i*NUM_OF_FILTERS + j];
		}
	}
	
	sprintf(str2, "X * theta = %f, ", result);
	HAL_UART_Transmit(&uartHandle, (uint8_t*)str2, strlen(str2), TIMEOUT);
	return (result >= 0);
}
